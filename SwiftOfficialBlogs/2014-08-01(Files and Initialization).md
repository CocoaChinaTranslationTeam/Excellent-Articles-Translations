-  本文翻译自Swift官方博客，原文地址：[Interacting with C Pointers](https://developer.apple.com/swift/blog/?id=6)
-  译者：[DevTalking](http://www.devtalking.com/)

# 文件和初始化
到目前为止，大多数开发者已经可以写出简单的Swift应用或者在`Playground`实验Swift语言的新特性。也许你也经历过这种情况，当你将`Playground`中运行正常的代码拷贝到Swift源文件中却发生了编译错误，“这到底是怎么回事？`Playground`文件和Swift源文件之间到底有什么不同？” 这篇文将告诉你们如何处理Swift项目中的各种文件，以及如何初始化全局数据。

## 应用中的文件
一个Swift应用必定会包含很多个源文件，基本上每个源文件中都有构成该应用的函数、类和其他一些申明等。Swift应用中的大多数源文件都是不需要按顺序访问的，都是**无顺序**的，你甚至可以在某个模块的最底部导入需要的源文件（虽然Swift不推荐这种编码风格）。  

不管怎样，在大多数Swift的源文件中是不允许有最顶层级别的代码的。这里解释一下顶层代码，任何写在函数体、类之外，或被封装供他人调用的可执行语句我们称为顶层代码。我们之所以不允许出现顶层代码，是因为它会影响我们判断程序是从哪里开始运行的。

## Playground，REPL，顶层代码
你可能会奇怪，为什么下面的代码在`Playground`中可以完美执行。由于它并没有包含任何其他东西，所以它必然是顶层代码：

```swift
println("Hello world")
```

上面的单行程序在没有任何其他代码的情况就可以正常运行，是因为`Playground`支持执行顶层代码。并且在`Playground`中引入的文件或者代码是按自上而下的顺序执行的。比如说，你不能在定义某个类型之前去使用它。当然，在Swift的`Playground`中也可以定义函数、类和其他在Swift中合法的任何类型，但并没有必要这么做。`Playground`的目的在于让开发者们能更简单、更快速的学习Swift语言和实验新的API，而不用创建大量Swift源文件去做这些事。

除了`Playground`，顶层代码也可以在`REPL`（Read-Eval-Print-Loop）中运行或作为脚本在Swift文件启动时运行。通过脚本使用Swift时，你可以在终端中用`#!/usr/bin/xcrun swift`或者`xcrun swift myFile.swift`的方式使用Swift文件。

## 应用程序的入口与“main.swift”
你可能也注意到了，在上面的文章中，我们提到在大多数的源文件中是不允许使用顶层代码的。但对一个文件除外，那就是`main.swift`文件，该文件的作用类似于`Playground`，但是它是随着你应用的其他源文件一起编译的。`main.swift`文件中允许顶层代码并且执行顺序是自上而下的。实际上，`main.swift`文件中的第一行代码就默认为是程序的入口。正因为如此，所以我们才能看到在Swift最小的程序只有一行代码，但它必须要在`main.swift`文件中。  

在Xcode中，Mac程序模板文件中就包含一个`main.swift`文件，但在iOS程序的项目模板中是通过在Swift文件中添加`@UIApplicationMain`标签注明项目入口的。这样做会让编译器忽略`main.swift`入口文件，而将标注有`@UIApplicationMain`标签的文件当做入口文件。

## 全局变量
我们已经知道了Swift是如何判断程序的执行入口，那么全局变量是如何工作的呢？下面的这行代码，在运行时需要初始化吗？

```swift
var someGlobal = foo()
```

在单文件的程序中，代码是自上而下执行的，这类似于函数中变量的执行方式。这虽然看起来很简单，但是在复杂的程序中我们就不是很好回答这个问题了。我们从下面三个方面来考虑：

1. 限制初始化，像简单的常量表达式，比如C语言。
2. 任意初始化，在应用程序加载执行静态构造函数时初始化，比如C++语言。
3. 延迟初始化，当全局变量第一次被使用的时候初始化，比如Java语言。

我们基本排除第一种情况，因为在Swift中不需要像C语言中的常量表达式。在Swift中，常量通常是在函数调用的时候执行的（内联）。而且也有更好的理由使用复杂的初始化方法，比如设置一个单例或者实例化一个字典。

第二种情况我们也基本排除，因为它在大型、复杂的程序中的效率很差。因为所有的初始化都要在应用程序启动之前，但是我们无法预测初始化的顺序，所以会有问题。

Swift采用第三种情况，这是最好的方法：允许自定义初始化，在程序启动时不会因为要进行大量初始化而降低效率，并且我们也可以预知每次初始化完成的顺序。

延迟初始化的全局变量（也包括结构体和枚举中的静态成员）是在第一次访问他们的时候才初始化的，并且以`dispatch_once`运行，确保了线程安全。你可以更酷的使用`dispatch_once`：只需要申明一个全局变量并初始化，再将其访问级别申明为`private`。

## 总结
Swift语言的设计使得它可以很方便的在`Playground`中进行试验或快捷的编写脚本。一个完整的程序可以只有一行代码。当然，你也可以使用Swift编写出各种复杂的应用程序。你可以通过`main.swift`掌控各种初始化的完成时机，或者通过`@UIApplicationMain`标签指定你的iOS应用的程序入口。